"use strict";(self.webpackChunkimdeepmind=self.webpackChunkimdeepmind||[]).push([[3718],{53835:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"frameworks-libraries/backend/flask/database-integration","title":"Database Integration and Flask-SQLAlchemy","description":"Flask, being a lightweight web framework, doesn\'t come with built-in database support, but it can easily integrate with various database systems using extensions. Database integration allows Flask applications to interact with persistent data stores (e.g., relational databases like MySQL, PostgreSQL, SQLite, and NoSQL databases like MongoDB).","source":"@site/docs/frameworks-libraries/backend/flask/database-integration.md","sourceDirName":"frameworks-libraries/backend/flask","slug":"/frameworks-libraries/backend/flask/database-integration","permalink":"/docs/frameworks-libraries/backend/flask/database-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/imdeepmind/imdeepmind.github.io/blob/main/docs/frameworks-libraries/backend/flask/database-integration.md","tags":[],"version":"current","lastUpdatedBy":"Abhishek Chatterjee","lastUpdatedAt":1749212834000,"sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"Error Handling","permalink":"/docs/frameworks-libraries/backend/flask/error-handling"},"next":{"title":"Async in Flask","permalink":"/docs/frameworks-libraries/backend/flask/async-flask"}}');var i=n(74848),r=n(28453);const l={sidebar_position:11},t="Database Integration and Flask-SQLAlchemy",o={},d=[{value:"Flask-SQLAlchemy: Overview",id:"flask-sqlalchemy-overview",level:2},{value:"Setting Up Flask-SQLAlchemy",id:"setting-up-flask-sqlalchemy",level:2},{value:"Installation",id:"installation",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Example: SQLite Database",id:"example-sqlite-database",level:4},{value:"Defining Database Models",id:"defining-database-models",level:2},{value:"Example: Defining a User Model",id:"example-defining-a-user-model",level:3},{value:"Performing CRUD Operations",id:"performing-crud-operations",level:2},{value:"Create",id:"create",level:3},{value:"Read",id:"read",level:3},{value:"Query All Users",id:"query-all-users",level:4},{value:"Query a Single User by ID",id:"query-a-single-user-by-id",level:4},{value:"Query with Filters",id:"query-with-filters",level:4},{value:"Update",id:"update",level:3},{value:"Delete",id:"delete",level:3},{value:"Database Migrations with Flask-Migrate",id:"database-migrations-with-flask-migrate",level:2},{value:"Installation",id:"installation-1",level:3},{value:"Setup",id:"setup",level:3},{value:"Handling Database Relationships",id:"handling-database-relationships",level:2},{value:"Example: One-to-Many Relationship",id:"example-one-to-many-relationship",level:3},{value:"Example: Many-to-Many Relationship",id:"example-many-to-many-relationship",level:3}];function c(e){const a={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.header,{children:(0,i.jsx)(a.h1,{id:"database-integration-and-flask-sqlalchemy",children:"Database Integration and Flask-SQLAlchemy"})}),"\n",(0,i.jsx)(a.p,{children:"Flask, being a lightweight web framework, doesn't come with built-in database support, but it can easily integrate with various database systems using extensions. Database integration allows Flask applications to interact with persistent data stores (e.g., relational databases like MySQL, PostgreSQL, SQLite, and NoSQL databases like MongoDB)."}),"\n",(0,i.jsxs)(a.p,{children:["Flask supports several tools and libraries for database interaction, with ",(0,i.jsx)(a.strong,{children:"SQLAlchemy"})," being one of the most popular and powerful extensions for working with relational databases. Flask also supports direct integration with other databases via native libraries and third-party extensions."]}),"\n",(0,i.jsx)(a.h2,{id:"flask-sqlalchemy-overview",children:"Flask-SQLAlchemy: Overview"}),"\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Flask-SQLAlchemy"})," is an extension for Flask that adds support for SQLAlchemy, a powerful Object-Relational Mapping (ORM) library for Python. With Flask-SQLAlchemy, you can work with databases using high-level Python objects instead of writing raw SQL queries."]}),"\n",(0,i.jsx)(a.p,{children:"SQLAlchemy provides two main components:"}),"\n",(0,i.jsxs)(a.ol,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Core"}),": Provides the underlying database connection and raw SQL query capabilities."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"ORM"}),": Allows interaction with databases using Python classes that map to database tables."]}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"Flask-SQLAlchemy integrates these components seamlessly into Flask applications, making it easier to manage your database schema and interact with the data."}),"\n",(0,i.jsx)(a.h2,{id:"setting-up-flask-sqlalchemy",children:"Setting Up Flask-SQLAlchemy"}),"\n",(0,i.jsx)(a.h3,{id:"installation",children:"Installation"}),"\n",(0,i.jsxs)(a.p,{children:["To begin using ",(0,i.jsx)(a.strong,{children:"Flask-SQLAlchemy"}),", you need to install the required libraries."]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"pip install Flask-SQLAlchemy\n"})}),"\n",(0,i.jsx)(a.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(a.p,{children:["After installation, you need to configure the database URI in the Flask application to tell Flask-SQLAlchemy where to connect. Typically, the database URI is set using the ",(0,i.jsx)(a.code,{children:"SQLALCHEMY_DATABASE_URI"})," configuration key. This URI specifies the database type, username, password, host, and database name."]}),"\n",(0,i.jsx)(a.h4,{id:"example-sqlite-database",children:"Example: SQLite Database"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"from flask import Flask\r\nfrom flask_sqlalchemy import SQLAlchemy\r\n\r\napp = Flask(__name__)\r\n\r\n# Set up the database URI (SQLite in this case)\r\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///site.db'  # SQLite file-based DB\r\napp.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False  # Disable modification tracking to save resources\r\n\r\n# Initialize the SQLAlchemy object\r\ndb = SQLAlchemy(app)\n"})}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"SQLALCHEMY_DATABASE_URI"}),": Specifies the location of the database."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"SQLALCHEMY_TRACK_MODIFICATIONS"}),": Flask-SQLAlchemy uses signals to track object modifications, but this feature can be disabled to save resources in most applications."]}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"For other databases, the URI changes as follows:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"PostgreSQL"}),": ",(0,i.jsx)(a.code,{children:"'postgresql://username:password@localhost/dbname'"})]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"MySQL"}),": ",(0,i.jsx)(a.code,{children:"'mysql://username:password@localhost/dbname'"})]}),"\n"]}),"\n",(0,i.jsx)(a.h2,{id:"defining-database-models",children:"Defining Database Models"}),"\n",(0,i.jsxs)(a.p,{children:["A ",(0,i.jsx)(a.strong,{children:"model"})," in Flask-SQLAlchemy is a Python class that represents a table in the database. The class inherits from ",(0,i.jsx)(a.code,{children:"db.Model"})," and defines attributes (columns) of the table."]}),"\n",(0,i.jsx)(a.h3,{id:"example-defining-a-user-model",children:"Example: Defining a User Model"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"class User(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)  # Integer column for ID, primary key\r\n    username = db.Column(db.String(120), unique=True, nullable=False)  # String column for username\r\n    email = db.Column(db.String(120), unique=True, nullable=False)  # String column for email\r\n    password = db.Column(db.String(60), nullable=False)  # String column for password\r\n\r\n    def __repr__(self):\r\n        return f\"User('{self.username}', '{self.email}')\"\n"})}),"\n",(0,i.jsx)(a.p,{children:"In this example:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"db.Column"})," specifies a column in the database."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"primary_key=True"}),": Marks the ",(0,i.jsx)(a.code,{children:"id"})," field as the primary key."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"unique=True"}),": Ensures that the field is unique across all records."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"nullable=False"}),": Ensures that the column cannot have null values."]}),"\n",(0,i.jsxs)(a.li,{children:["The ",(0,i.jsx)(a.code,{children:"__repr__"})," method provides a string representation for debugging purposes."]}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"Flask-SQLAlchemy automatically translates the class into a corresponding table in the database."}),"\n",(0,i.jsx)(a.h2,{id:"performing-crud-operations",children:"Performing CRUD Operations"}),"\n",(0,i.jsx)(a.p,{children:"Once the model is defined, you can interact with the database and perform CRUD (Create, Read, Update, Delete) operations."}),"\n",(0,i.jsx)(a.h3,{id:"create",children:"Create"}),"\n",(0,i.jsx)(a.p,{children:"To create a new record, instantiate the model and add it to the database session."}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"new_user = User(username='johndoe', email='johndoe@example.com', password='password123')\r\ndb.session.add(new_user)\r\ndb.session.commit()  # Commit the transaction to save the record to the database\n"})}),"\n",(0,i.jsx)(a.h3,{id:"read",children:"Read"}),"\n",(0,i.jsx)(a.p,{children:"To query the database, you can use SQLAlchemy's querying capabilities to retrieve records."}),"\n",(0,i.jsx)(a.h4,{id:"query-all-users",children:"Query All Users"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"users = User.query.all()  # Get all users from the User table\n"})}),"\n",(0,i.jsx)(a.h4,{id:"query-a-single-user-by-id",children:"Query a Single User by ID"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"user = User.query.get(1)  # Get the user with ID 1\n"})}),"\n",(0,i.jsx)(a.h4,{id:"query-with-filters",children:"Query with Filters"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"user = User.query.filter_by(username='johndoe').first()  # Get the first user with username 'johndoe'\n"})}),"\n",(0,i.jsx)(a.h3,{id:"update",children:"Update"}),"\n",(0,i.jsx)(a.p,{children:"To update an existing record, fetch the record, modify its attributes, and commit the transaction."}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"user = User.query.get(1)\r\nuser.username = 'johnsmith'\r\ndb.session.commit()  # Save the changes to the database\n"})}),"\n",(0,i.jsx)(a.h3,{id:"delete",children:"Delete"}),"\n",(0,i.jsxs)(a.p,{children:["To delete a record, fetch the record and call ",(0,i.jsx)(a.code,{children:"db.session.delete()"})," followed by ",(0,i.jsx)(a.code,{children:"db.session.commit()"}),"."]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"user = User.query.get(1)\r\ndb.session.delete(user)\r\ndb.session.commit()  # Delete the user record from the database\n"})}),"\n",(0,i.jsx)(a.h2,{id:"database-migrations-with-flask-migrate",children:"Database Migrations with Flask-Migrate"}),"\n",(0,i.jsxs)(a.p,{children:["Database migrations are an essential part of database management, allowing you to evolve your database schema over time without losing data. ",(0,i.jsx)(a.strong,{children:"Flask-Migrate"})," is an extension that integrates ",(0,i.jsx)(a.strong,{children:"Alembic"})," (a lightweight database migration tool for SQLAlchemy) with Flask."]}),"\n",(0,i.jsx)(a.h3,{id:"installation-1",children:"Installation"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"pip install Flask-Migrate\n"})}),"\n",(0,i.jsx)(a.h3,{id:"setup",children:"Setup"}),"\n",(0,i.jsx)(a.p,{children:"First, initialize the migration repository:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"from flask_migrate import Migrate\r\n\r\nmigrate = Migrate(app, db)\n"})}),"\n",(0,i.jsxs)(a.p,{children:["In your application's entry point (",(0,i.jsx)(a.code,{children:"app.py"}),"), you also need to create the migration commands:"]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"from flask import Flask\r\nfrom flask_sqlalchemy import SQLAlchemy\r\nfrom flask_migrate import Migrate\r\n\r\napp = Flask(__name__)\r\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///site.db'\r\ndb = SQLAlchemy(app)\r\nmigrate = Migrate(app, db)\n"})}),"\n",(0,i.jsx)(a.p,{children:"Now you can use the following commands for migration:"}),"\n",(0,i.jsxs)(a.ol,{children:["\n",(0,i.jsxs)(a.li,{children:["\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Initialize migration scripts"}),":"]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"flask db init\n"})}),"\n"]}),"\n",(0,i.jsxs)(a.li,{children:["\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Create a migration script"}),":"]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:'flask db migrate -m "Initial migration"\n'})}),"\n"]}),"\n",(0,i.jsxs)(a.li,{children:["\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Apply the migration"}),":"]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"flask db upgrade\n"})}),"\n"]}),"\n",(0,i.jsxs)(a.li,{children:["\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Rollback to previous migrations"}),":"]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"flask db downgrade\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(a.h2,{id:"handling-database-relationships",children:"Handling Database Relationships"}),"\n",(0,i.jsxs)(a.p,{children:["Flask-SQLAlchemy supports defining relationships between models using ",(0,i.jsx)(a.code,{children:"db.relationship()"})," and ",(0,i.jsx)(a.code,{children:"db.ForeignKey()"}),"."]}),"\n",(0,i.jsx)(a.h3,{id:"example-one-to-many-relationship",children:"Example: One-to-Many Relationship"}),"\n",(0,i.jsxs)(a.p,{children:["Consider a scenario where each ",(0,i.jsx)(a.code,{children:"User"})," can have multiple ",(0,i.jsx)(a.code,{children:"Post"}),"s."]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"class Post(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    title = db.Column(db.String(120), nullable=False)\r\n    content = db.Column(db.Text, nullable=False)\r\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\r\n\r\n    user = db.relationship('User', back_populates='posts')\r\n\r\nUser.posts = db.relationship('Post', back_populates='user', lazy=True)\n"})}),"\n",(0,i.jsx)(a.p,{children:"In this example:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"user_id"})," is a foreign key that refers to the ",(0,i.jsx)(a.code,{children:"User"})," table."]}),"\n",(0,i.jsxs)(a.li,{children:["The ",(0,i.jsx)(a.code,{children:"db.relationship()"})," method is used to define a relationship between ",(0,i.jsx)(a.code,{children:"User"})," and ",(0,i.jsx)(a.code,{children:"Post"}),"."]}),"\n"]}),"\n",(0,i.jsx)(a.h3,{id:"example-many-to-many-relationship",children:"Example: Many-to-Many Relationship"}),"\n",(0,i.jsx)(a.p,{children:"For a many-to-many relationship, you typically use an auxiliary table to represent the connection."}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"association_table = db.Table('association',\r\n    db.Column('user_id', db.Integer, db.ForeignKey('user.id')),\r\n    db.Column('group_id', db.Integer, db.ForeignKey('group.id'))\r\n)\r\n\r\nclass User(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    groups = db.relationship('Group', secondary=association_table, backref=db.backref('users', lazy='dynamic'))\r\n\r\nclass Group(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    name = db.Column(db.String(100), unique=True)\n"})})]})}function h(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,i.jsx)(a,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,a,n)=>{n.d(a,{R:()=>l,x:()=>t});var s=n(96540);const i={},r=s.createContext(i);function l(e){const a=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:a},e.children)}}}]);