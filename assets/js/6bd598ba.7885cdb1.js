"use strict";(self.webpackChunkimdeepmind=self.webpackChunkimdeepmind||[]).push([[1598],{1312:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>t,default:()=>p,frontMatter:()=>d,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"frameworks-libraries/backend/fastapi/advanced-features","title":"Advanced FastAPI Features","description":"FastAPI offers powerful features beyond basic CRUD APIs, including background tasks, file handling, WebSockets, middleware, cookies/headers, and custom responses. Below is a detailed breakdown of each.","source":"@site/docs/frameworks-libraries/backend/fastapi/advanced-features.md","sourceDirName":"frameworks-libraries/backend/fastapi","slug":"/frameworks-libraries/backend/fastapi/advanced-features","permalink":"/docs/frameworks-libraries/backend/fastapi/advanced-features","draft":false,"unlisted":false,"editUrl":"https://github.com/imdeepmind/imdeepmind.github.io/blob/main/docs/frameworks-libraries/backend/fastapi/advanced-features.md","tags":[],"version":"current","lastUpdatedBy":"Abhishek Chatterjee","lastUpdatedAt":1749212834000,"sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"ORMs","permalink":"/docs/frameworks-libraries/backend/fastapi/orm"},"next":{"title":"Performance & Optimization","permalink":"/docs/frameworks-libraries/backend/fastapi/optimization"}}');var i=n(74848),r=n(28453);const d={sidebar_position:7},t="Advanced FastAPI Features",l={},o=[{value:"Background Tasks (<code>BackgroundTasks</code>)",id:"background-tasks-backgroundtasks",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Example: Sending an Email in Background",id:"example-sending-an-email-in-background",level:3},{value:"Static Files &amp; File Uploads (<code>File</code>, <code>UploadFile</code>)",id:"static-files--file-uploads-file-uploadfile",level:2},{value:"(A) Serving Static Files",id:"a-serving-static-files",level:3},{value:"(B) Handling File Uploads",id:"b-handling-file-uploads",level:3},{value:"WebSockets (<code>@app.websocket(&quot;/ws&quot;)</code>)",id:"websockets-appwebsocketws",level:2},{value:"Basic WebSocket Example",id:"basic-websocket-example",level:3},{value:"Handling Multiple Clients",id:"handling-multiple-clients",level:3},{value:"Middleware (<code>app.add_middleware</code>)",id:"middleware-appadd_middleware",level:2},{value:"Built-in Middleware Example (CORS)",id:"built-in-middleware-example-cors",level:3},{value:"Custom Middleware (Logging)",id:"custom-middleware-logging",level:3},{value:"Custom Middleware (Logging, Error Handling)",id:"custom-middleware-logging-error-handling",level:2},{value:"(A) Logging Middleware",id:"a-logging-middleware",level:3},{value:"(B) Error Handling Middleware",id:"b-error-handling-middleware",level:3},{value:"Handling Cookies &amp; Headers",id:"handling-cookies--headers",level:2},{value:"(A) Setting Cookies",id:"a-setting-cookies",level:3},{value:"(B) Reading Headers",id:"b-reading-headers",level:3},{value:"Response Headers &amp; Custom Responses",id:"response-headers--custom-responses",level:2},{value:"(A) Custom Headers",id:"a-custom-headers",level:3},{value:"(B) Redirect Responses",id:"b-redirect-responses",level:3},{value:"(C) File Responses",id:"c-file-responses",level:3},{value:"Summary Table",id:"summary-table",level:2}];function c(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"advanced-fastapi-features",children:"Advanced FastAPI Features"})}),"\n",(0,i.jsxs)(s.p,{children:["FastAPI offers powerful features beyond basic CRUD APIs, including ",(0,i.jsx)(s.strong,{children:"background tasks, file handling, WebSockets, middleware, cookies/headers, and custom responses"}),". Below is a ",(0,i.jsx)(s.strong,{children:"detailed breakdown"})," of each."]}),"\n",(0,i.jsxs)(s.h2,{id:"background-tasks-backgroundtasks",children:["Background Tasks (",(0,i.jsx)(s.code,{children:"BackgroundTasks"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Use Case"}),": Run non-blocking operations ",(0,i.jsx)(s.strong,{children:"after"})," sending a response (e.g., sending emails, processing data)."]}),"\n",(0,i.jsx)(s.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Tasks run ",(0,i.jsx)(s.strong,{children:"after the response is sent"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Ideal for ",(0,i.jsx)(s.strong,{children:"non-critical"})," operations (don\u2019t block the request)."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"example-sending-an-email-in-background",children:"Example: Sending an Email in Background"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi import BackgroundTasks, FastAPI\n\napp = FastAPI()\n\ndef send_email(email: str, message: str):\n    print(f"Sending email to {email}: {message}")  # Simulate email send\n\n@app.post("/notify")\nasync def notify_user(\n    email: str,\n    background_tasks: BackgroundTasks\n):\n    background_tasks.add_task(send_email, email, "Hello, user!")\n    return {"message": "Notification sent in background"}\n'})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Key Points"}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Use ",(0,i.jsx)(s.code,{children:"BackgroundTasks"})," as a ",(0,i.jsx)(s.strong,{children:"dependency"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Tasks run ",(0,i.jsx)(s.strong,{children:"even if the request fails"})," (unless the server crashes)."]}),"\n"]}),"\n",(0,i.jsxs)(s.h2,{id:"static-files--file-uploads-file-uploadfile",children:["Static Files & File Uploads (",(0,i.jsx)(s.code,{children:"File"}),", ",(0,i.jsx)(s.code,{children:"UploadFile"}),")"]}),"\n",(0,i.jsx)(s.h3,{id:"a-serving-static-files",children:"(A) Serving Static Files"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi.staticfiles import StaticFiles\n\napp = FastAPI()\napp.mount("/static", StaticFiles(directory="static"), name="static")\n'})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Files in ",(0,i.jsx)(s.code,{children:"./static/"})," are served at ",(0,i.jsx)(s.code,{children:"/static/"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"b-handling-file-uploads",children:"(B) Handling File Uploads"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi import UploadFile, File\n\n@app.post("/upload")\nasync def upload_file(file: UploadFile = File(...)):\n    contents = await file.read()\n    return {\n        "filename": file.filename,\n        "size": len(contents),\n    }\n'})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Features"}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"UploadFile"})," uses ",(0,i.jsx)(s.strong,{children:"async I/O"})," (better for large files)."]}),"\n",(0,i.jsxs)(s.li,{children:["Automatically handles ",(0,i.jsx)(s.strong,{children:"multipart/form-data"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.h2,{id:"websockets-appwebsocketws",children:["WebSockets (",(0,i.jsx)(s.code,{children:'@app.websocket("/ws")'}),")"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Use Case"}),": Real-time communication (chat, live updates)."]}),"\n",(0,i.jsx)(s.h3,{id:"basic-websocket-example",children:"Basic WebSocket Example"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi import WebSocket\n\n@app.websocket("/ws")\nasync def websocket_endpoint(websocket: WebSocket):\n    await websocket.accept()\n    while True:\n        data = await websocket.receive_text()\n        await websocket.send_text(f"Echo: {data}")\n'})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Workflow"}),":"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Client connects via ",(0,i.jsx)(s.code,{children:"ws://localhost:8000/ws"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Server ",(0,i.jsx)(s.strong,{children:"accepts"})," the connection."]}),"\n",(0,i.jsxs)(s.li,{children:["Messages are ",(0,i.jsx)(s.strong,{children:"sent/received"})," asynchronously."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"handling-multiple-clients",children:"Handling Multiple Clients"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi import WebSocket, WebSocketDisconnect\n\nclass ConnectionManager:\n    def __init__(self):\n        self.connections = []\n\n    async def connect(self, websocket: WebSocket):\n        await websocket.accept()\n        self.connections.append(websocket)\n\n    async def broadcast(self, message: str):\n        for connection in self.connections:\n            await connection.send_text(message)\n\nmanager = ConnectionManager()\n\n@app.websocket("/chat")\nasync def chat(websocket: WebSocket):\n    await manager.connect(websocket)\n    try:\n        while True:\n            data = await websocket.receive_text()\n            await manager.broadcast(f"User said: {data}")\n    except WebSocketDisconnect:\n        manager.connections.remove(websocket)\n'})}),"\n",(0,i.jsxs)(s.h2,{id:"middleware-appadd_middleware",children:["Middleware (",(0,i.jsx)(s.code,{children:"app.add_middleware"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Middleware"})," intercepts ",(0,i.jsx)(s.strong,{children:"requests/responses"})," (e.g., logging, CORS, auth)."]}),"\n",(0,i.jsx)(s.h3,{id:"built-in-middleware-example-cors",children:"Built-in Middleware Example (CORS)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi.middleware.cors import CORSMiddleware\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=["*"],  # Allow all domains (adjust in production!)\n    allow_methods=["GET", "POST"],\n)\n'})}),"\n",(0,i.jsx)(s.h3,{id:"custom-middleware-logging",children:"Custom Middleware (Logging)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi import Request\n\n@app.middleware("http")\nasync def log_requests(request: Request, call_next):\n    print(f"Incoming request: {request.url}")\n    response = await call_next(request)\n    print(f"Response status: {response.status_code}")\n    return response\n'})}),"\n",(0,i.jsx)(s.h2,{id:"custom-middleware-logging-error-handling",children:"Custom Middleware (Logging, Error Handling)"}),"\n",(0,i.jsx)(s.h3,{id:"a-logging-middleware",children:"(A) Logging Middleware"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'import time\n\n@app.middleware("http")\nasync def add_process_time(request: Request, call_next):\n    start_time = time.time()\n    response = await call_next(request)\n    process_time = time.time() - start_time\n    response.headers["X-Process-Time"] = str(process_time)\n    return response\n'})}),"\n",(0,i.jsx)(s.h3,{id:"b-error-handling-middleware",children:"(B) Error Handling Middleware"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi.responses import JSONResponse\n\n@app.middleware("http")\nasync def handle_errors(request: Request, call_next):\n    try:\n        return await call_next(request)\n    except Exception as e:\n        return JSONResponse(\n            status_code=500,\n            content={"error": str(e)},\n        )\n'})}),"\n",(0,i.jsx)(s.h2,{id:"handling-cookies--headers",children:"Handling Cookies & Headers"}),"\n",(0,i.jsx)(s.h3,{id:"a-setting-cookies",children:"(A) Setting Cookies"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi import Response\n\n@app.get("/set-cookie")\ndef set_cookie(response: Response):\n    response.set_cookie(key="user", value="fake-user")\n    return {"message": "Cookie set"}\n'})}),"\n",(0,i.jsx)(s.h3,{id:"b-reading-headers",children:"(B) Reading Headers"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi import Header\n\n@app.get("/headers")\ndef read_headers(user_agent: str = Header(None)):\n    return {"User-Agent": user_agent}\n'})}),"\n",(0,i.jsx)(s.h2,{id:"response-headers--custom-responses",children:"Response Headers & Custom Responses"}),"\n",(0,i.jsx)(s.h3,{id:"a-custom-headers",children:"(A) Custom Headers"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi.responses import JSONResponse\n\n@app.get("/custom-headers")\ndef custom_headers():\n    content = {"message": "Hello"}\n    headers = {"X-Custom-Header": "FastAPI"}\n    return JSONResponse(content=content, headers=headers)\n'})}),"\n",(0,i.jsx)(s.h3,{id:"b-redirect-responses",children:"(B) Redirect Responses"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi.responses import RedirectResponse\n\n@app.get("/redirect")\ndef redirect():\n    return RedirectResponse(url="https://fastapi.tiangolo.com")\n'})}),"\n",(0,i.jsx)(s.h3,{id:"c-file-responses",children:"(C) File Responses"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from fastapi.responses import FileResponse\n\n@app.get("/download")\ndef download_file():\n    return FileResponse("large_file.zip", filename="downloaded.zip")\n'})}),"\n",(0,i.jsx)(s.h2,{id:"summary-table",children:"Summary Table"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Feature"}),(0,i.jsx)(s.th,{children:"Use Case"}),(0,i.jsx)(s.th,{children:"Key Functionality"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Background Tasks"})}),(0,i.jsx)(s.td,{children:"Async post-response ops"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"BackgroundTasks.add_task()"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Static Files"})}),(0,i.jsx)(s.td,{children:"Serve CSS/JS/images"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:'StaticFiles(directory="static")'})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"File Uploads"})}),(0,i.jsx)(s.td,{children:"Handle user uploads"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"UploadFile"}),", ",(0,i.jsx)(s.code,{children:"File(...)"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"WebSockets"})}),(0,i.jsx)(s.td,{children:"Real-time communication"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"@app.websocket"}),", ",(0,i.jsx)(s.code,{children:"WebSocket"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Middleware"})}),(0,i.jsx)(s.td,{children:"Global request/response handling"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"app.add_middleware()"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Cookies/Headers"})}),(0,i.jsx)(s.td,{children:"Read/write HTTP metadata"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"Response.set_cookie()"}),", ",(0,i.jsx)(s.code,{children:"Header()"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Custom Responses"})}),(0,i.jsx)(s.td,{children:"Non-JSON responses"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"JSONResponse"}),", ",(0,i.jsx)(s.code,{children:"RedirectResponse"})]})]})]})]})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>t});var a=n(96540);const i={},r=a.createContext(i);function d(e){const s=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),a.createElement(r.Provider,{value:s},e.children)}}}]);