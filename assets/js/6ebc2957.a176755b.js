"use strict";(self.webpackChunkimdeepmind=self.webpackChunkimdeepmind||[]).push([[5382],{4288:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"frameworks-libraries/backend/fastapi/auth","title":"Authentication & Security","description":"FastAPI provides built-in security utilities for implementing authentication, authorization, and secure API communication. Below is a detailed breakdown of key security concepts and their implementation in FastAPI.","source":"@site/docs/frameworks-libraries/backend/fastapi/auth.md","sourceDirName":"frameworks-libraries/backend/fastapi","slug":"/frameworks-libraries/backend/fastapi/auth","permalink":"/docs/frameworks-libraries/backend/fastapi/auth","draft":false,"unlisted":false,"editUrl":"https://github.com/imdeepmind/imdeepmind.github.io/blob/main/docs/frameworks-libraries/backend/fastapi/auth.md","tags":[],"version":"current","lastUpdatedBy":"Abhishek Chatterjee","lastUpdatedAt":1749212834000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Dependency Injection","permalink":"/docs/frameworks-libraries/backend/fastapi/dependency-injection"},"next":{"title":"ORMs","permalink":"/docs/frameworks-libraries/backend/fastapi/orm"}}');var r=s(74848),i=s(28453);const a={sidebar_position:5},d="Authentication & Security",o={},c=[{value:"Introduction to OAuth2 &amp; JWT",id:"introduction-to-oauth2--jwt",level:2},{value:"OAuth2",id:"oauth2",level:3},{value:"JWT (JSON Web Tokens)",id:"jwt-json-web-tokens",level:3},{value:"Password Hashing (<code>bcrypt</code>, <code>passlib</code>)",id:"password-hashing-bcrypt-passlib",level:2},{value:"Using <code>passlib</code> with <code>bcrypt</code>",id:"using-passlib-with-bcrypt",level:3},{value:"OAuth2 with Password (and Hashing), Bearer with JWT Tokens",id:"oauth2-with-password-and-hashing-bearer-with-jwt-tokens",level:2},{value:"Step-by-Step Implementation",id:"step-by-step-implementation",level:3},{value:"(1) Define OAuth2 Password Flow",id:"1-define-oauth2-password-flow",level:4},{value:"(2) Authenticate User &amp; Generate JWT",id:"2-authenticate-user--generate-jwt",level:4},{value:"(3) Protect Routes with JWT",id:"3-protect-routes-with-jwt",level:4},{value:"JWT (JSON Web Tokens) Implementation",id:"jwt-json-web-tokens-implementation",level:2},{value:"Key Components",id:"key-components",level:3},{value:"Token Generation &amp; Verification",id:"token-generation--verification",level:3},{value:"Role-Based Access Control (RBAC)",id:"role-based-access-control-rbac",level:2},{value:"Implementation",id:"implementation",level:3},{value:"API Key Authentication (<code>APIKeyHeader</code>, <code>APIKeyQuery</code>)",id:"api-key-authentication-apikeyheader-apikeyquery",level:2},{value:"Using <code>APIKeyHeader</code>",id:"using-apikeyheader",level:3},{value:"Using <code>APIKeyQuery</code>",id:"using-apikeyquery",level:3},{value:"CORS (Cross-Origin Resource Sharing) Middleware",id:"cors-cross-origin-resource-sharing-middleware",level:2},{value:"Enable CORS in FastAPI",id:"enable-cors-in-fastapi",level:3}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"authentication--security",children:"Authentication & Security"})}),"\n",(0,r.jsxs)(n.p,{children:["FastAPI provides ",(0,r.jsx)(n.strong,{children:"built-in security utilities"})," for implementing ",(0,r.jsx)(n.strong,{children:"authentication, authorization, and secure API communication"}),". Below is a detailed breakdown of key security concepts and their implementation in FastAPI."]}),"\n",(0,r.jsx)(n.h2,{id:"introduction-to-oauth2--jwt",children:"Introduction to OAuth2 & JWT"}),"\n",(0,r.jsx)(n.h3,{id:"oauth2",children:"OAuth2"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"standard protocol"})," for authorization (not authentication, but often used for both)."]}),"\n",(0,r.jsxs)(n.li,{children:["Allows third-party apps to access user data ",(0,r.jsx)(n.strong,{children:"without exposing passwords"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Common ",(0,r.jsx)(n.strong,{children:"OAuth2 flows"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Password Flow"})," (for trusted apps, requires username/password)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authorization Code Flow"})," (for web apps, uses redirects)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client Credentials Flow"})," (for machine-to-machine auth)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Implicit Flow"})," (legacy, not recommended)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"jwt-json-web-tokens",children:"JWT (JSON Web Tokens)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"compact, URL-safe"})," way to represent claims between parties."]}),"\n",(0,r.jsxs)(n.li,{children:["Structure:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Header.Payload.Signature\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Header"}),": Algorithm & token type (",(0,r.jsx)(n.code,{children:'{"alg": "HS256", "typ": "JWT"}'}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Payload"}),": Claims (",(0,r.jsx)(n.code,{children:'{"sub": "user123", "exp": 1735689600}'}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Signature"}),": Ensures token integrity (HMAC, RSA, etc.)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Why JWT?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stateless"}),": No server-side session storage."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Self-contained"}),": User info is embedded."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secure"}),": Signed/encrypted to prevent tampering."]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"password-hashing-bcrypt-passlib",children:["Password Hashing (",(0,r.jsx)(n.code,{children:"bcrypt"}),", ",(0,r.jsx)(n.code,{children:"passlib"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Storing ",(0,r.jsx)(n.strong,{children:"plain-text passwords"})," is dangerous. Instead, use ",(0,r.jsx)(n.strong,{children:"hashing"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hashing"}),": One-way transformation (cannot be reversed)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Salting"}),": Adds random data to prevent rainbow table attacks."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"using-passlib-with-bcrypt",children:["Using ",(0,r.jsx)(n.code,{children:"passlib"})," with ",(0,r.jsx)(n.code,{children:"bcrypt"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from passlib.context import CryptContext\n\npwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")\n\n# Hash a password\nhashed_password = pwd_context.hash("mysecretpassword")\n\n# Verify a password\nis_valid = pwd_context.verify("mysecretpassword", hashed_password)\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best Practices"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Always ",(0,r.jsx)(n.strong,{children:"hash passwords"})," before storing."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.strong,{children:"strong algorithms"})," (",(0,r.jsx)(n.code,{children:"bcrypt"}),", ",(0,r.jsx)(n.code,{children:"argon2"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Never store ",(0,r.jsx)(n.strong,{children:"plain-text passwords"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"oauth2-with-password-and-hashing-bearer-with-jwt-tokens",children:"OAuth2 with Password (and Hashing), Bearer with JWT Tokens"}),"\n",(0,r.jsxs)(n.p,{children:["FastAPI supports ",(0,r.jsx)(n.strong,{children:"OAuth2 Password Flow"})," with JWT tokens."]}),"\n",(0,r.jsx)(n.h3,{id:"step-by-step-implementation",children:"Step-by-Step Implementation"}),"\n",(0,r.jsx)(n.h4,{id:"1-define-oauth2-password-flow",children:"(1) Define OAuth2 Password Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\n\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")\n'})}),"\n",(0,r.jsx)(n.h4,{id:"2-authenticate-user--generate-jwt",children:"(2) Authenticate User & Generate JWT"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from datetime import datetime, timedelta\nfrom jose import JWTError, jwt\n\nSECRET_KEY = "your-secret-key"\nALGORITHM = "HS256"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n\ndef create_access_token(data: dict, expires_delta: timedelta = None):\n    to_encode = data.copy()\n    if expires_delta:\n        expire = datetime.utcnow() + expires_delta\n    else:\n        expire = datetime.utcnow() + timedelta(minutes=15)\n    to_encode.update({"exp": expire})\n    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n    return encoded_jwt\n\n@app.post("/token")\ndef login(form_data: OAuth2PasswordRequestForm = Depends()):\n    user = authenticate_user(form_data.username, form_data.password)\n    if not user:\n        raise HTTPException(status_code=400, detail="Incorrect credentials")\n    access_token = create_access_token(data={"sub": user.username})\n    return {"access_token": access_token, "token_type": "bearer"}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"3-protect-routes-with-jwt",children:"(3) Protect Routes with JWT"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'async def get_current_user(token: str = Depends(oauth2_scheme)):\n    credentials_exception = HTTPException(\n        status_code=status.HTTP_401_UNAUTHORIZED,\n        detail="Invalid credentials",\n    )\n    try:\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n        username: str = payload.get("sub")\n        if username is None:\n            raise credentials_exception\n    except JWTError:\n        raise credentials_exception\n    return username\n\n@app.get("/protected")\nasync def protected_route(user: str = Depends(get_current_user)):\n    return {"message": f"Hello, {user}"}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"jwt-json-web-tokens-implementation",children:"JWT (JSON Web Tokens) Implementation"}),"\n",(0,r.jsx)(n.h3,{id:"key-components",children:"Key Components"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Component"}),(0,r.jsx)(n.th,{children:"Role"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"jose"})})}),(0,r.jsx)(n.td,{children:"Python library for JWT operations."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"SECRET_KEY"})})}),(0,r.jsx)(n.td,{children:"Used to sign tokens (keep it secret!)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"ALGORITHM"})})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"HS256"})," (symmetric), ",(0,r.jsx)(n.code,{children:"RS256"})," (asymmetric)."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"exp"})," claim"]})}),(0,r.jsx)(n.td,{children:"Ensures token expiry."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"token-generation--verification",children:"Token Generation & Verification"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from jose import jwt\n\n# Generate token\ntoken = jwt.encode({"sub": "user123"}, SECRET_KEY, algorithm=ALGORITHM)\n\n# Decode & verify\ndecoded = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n'})}),"\n",(0,r.jsx)(n.h2,{id:"role-based-access-control-rbac",children:"Role-Based Access Control (RBAC)"}),"\n",(0,r.jsxs)(n.p,{children:["Restrict routes based on ",(0,r.jsx)(n.strong,{children:"user roles"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import Depends, HTTPException\n\ndef get_current_user(token: str = Depends(oauth2_scheme)):\n    # Decode JWT and get user role\n    payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n    return {"username": payload["sub"], "role": payload.get("role", "user")}\n\ndef require_admin(user: dict = Depends(get_current_user)):\n    if user["role"] != "admin":\n        raise HTTPException(status_code=403, detail="Admin access required")\n    return user\n\n@app.get("/admin")\ndef admin_dashboard(user: dict = Depends(require_admin)):\n    return {"message": "Welcome, admin!"}\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"api-key-authentication-apikeyheader-apikeyquery",children:["API Key Authentication (",(0,r.jsx)(n.code,{children:"APIKeyHeader"}),", ",(0,r.jsx)(n.code,{children:"APIKeyQuery"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"For machine-to-machine authentication."}),"\n",(0,r.jsxs)(n.h3,{id:"using-apikeyheader",children:["Using ",(0,r.jsx)(n.code,{children:"APIKeyHeader"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi.security import APIKeyHeader\n\napi_key_header = APIKeyHeader(name="X-API-Key")\n\n@app.get("/secure")\ndef secure_route(api_key: str = Depends(api_key_header)):\n    if api_key != "valid-api-key":\n        raise HTTPException(status_code=403, detail="Invalid API Key")\n    return {"message": "Access granted"}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"using-apikeyquery",children:["Using ",(0,r.jsx)(n.code,{children:"APIKeyQuery"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi.security import APIKeyQuery\n\napi_key_query = APIKeyQuery(name="api_key")\n\n@app.get("/secure")\ndef secure_route(api_key: str = Depends(api_key_query)):\n    if api_key != "valid-api-key":\n        raise HTTPException(status_code=403, detail="Invalid API Key")\n    return {"message": "Access granted"}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"cors-cross-origin-resource-sharing-middleware",children:"CORS (Cross-Origin Resource Sharing) Middleware"}),"\n",(0,r.jsxs)(n.p,{children:["Allows ",(0,r.jsx)(n.strong,{children:"cross-domain requests"})," (e.g., frontend \u2194 backend)."]}),"\n",(0,r.jsx)(n.h3,{id:"enable-cors-in-fastapi",children:"Enable CORS in FastAPI"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi.middleware.cors import CORSMiddleware\n\napp = FastAPI()\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=["http://localhost:3000"],  # React/Vue app\n    allow_credentials=True,\n    allow_methods=["*"],\n    allow_headers=["*"],\n)\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Parameters"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"allow_origins"})}),(0,r.jsx)(n.td,{children:"Domains allowed to make requests."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"allow_methods"})}),(0,r.jsxs)(n.td,{children:["HTTP methods (",(0,r.jsx)(n.code,{children:"GET"}),", ",(0,r.jsx)(n.code,{children:"POST"}),", etc.)."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"allow_headers"})}),(0,r.jsx)(n.td,{children:"Headers allowed in requests."})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>d});var t=s(96540);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);