"use strict";(self.webpackChunkimdeepmind=self.webpackChunkimdeepmind||[]).push([[4452],{5021:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"system-design/containers/dockerfile","title":"Dockerfile","description":"A Dockerfile is a text file that contains a set of instructions on how to build a Docker image. It defines everything required to set up an environment, install dependencies, configure the software, and run applications inside a container. Dockerfiles are crucial for automating the process of building Docker images, making the process repeatable and consistent across different environments.","source":"@site/docs/system-design/containers/dockerfile.md","sourceDirName":"system-design/containers","slug":"/system-design/containers/dockerfile","permalink":"/docs/system-design/containers/dockerfile","draft":false,"unlisted":false,"editUrl":"https://github.com/imdeepmind/imdeepmind.github.io/blob/main/docs/system-design/containers/dockerfile.md","tags":[],"version":"current","lastUpdatedBy":"Abhishek Chatterjee","lastUpdatedAt":1736779410000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"tutorialSidebar","previous":{"title":"Docker CLI","permalink":"/docs/system-design/containers/docker-cli"},"next":{"title":"Introduction","permalink":"/docs/system-design/kubernetes/introduction"}}');var r=i(74848),t=i(28453);const c={sidebar_position:8},l="Dockerfile",o={},a=[{value:"Structure of a Dockerfile",id:"structure-of-a-dockerfile",level:2},{value:"Example of a Simple Dockerfile",id:"example-of-a-simple-dockerfile",level:2},{value:"Key Considerations When Writing a Dockerfile",id:"key-considerations-when-writing-a-dockerfile",level:2},{value:"Best Practices",id:"best-practices",level:2}];function d(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"dockerfile",children:"Dockerfile"})}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"Dockerfile"})," is a text file that contains a set of instructions on how to build a Docker image. It defines everything required to set up an environment, install dependencies, configure the software, and run applications inside a container. Dockerfiles are crucial for automating the process of building Docker images, making the process repeatable and consistent across different environments."]}),"\n",(0,r.jsx)(n.h2,{id:"structure-of-a-dockerfile",children:"Structure of a Dockerfile"}),"\n",(0,r.jsxs)(n.p,{children:["A Dockerfile consists of various ",(0,r.jsx)(n.strong,{children:"instructions"})," that tell Docker how to build the image. These instructions typically follow a specific sequence:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"FROM"}),(0,r.jsx)(n.br,{}),"\n","Defines the base image to use for the Docker image. It is the starting point for all Docker images."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"FROM ubuntu:20.04\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"LABEL"}),(0,r.jsx)(n.br,{}),"\n","Adds metadata to the image, such as author, version, description, etc. It is optional but recommended for keeping track of image information."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'LABEL maintainer="john.doe@example.com"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"RUN"}),(0,r.jsx)(n.br,{}),"\n","Executes commands inside the image during the build process. This is typically used to install dependencies or perform other setup tasks."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"RUN apt-get update && apt-get install -y python3\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"COPY"}),(0,r.jsx)(n.br,{}),"\n","Copies files or directories from the local system to the container\u2019s file system. This is used to add your application code or assets to the image."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"COPY . /app\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"ADD"}),(0,r.jsx)(n.br,{}),"\n","Similar to ",(0,r.jsx)(n.code,{children:"COPY"}),", but it has more functionality. It can extract tar archives, handle remote URLs, and copy files from URLs."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"ADD https://example.com/file.tar.gz /app\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"WORKDIR"}),(0,r.jsx)(n.br,{}),"\n","Sets the working directory for any subsequent ",(0,r.jsx)(n.code,{children:"RUN"}),", ",(0,r.jsx)(n.code,{children:"CMD"}),", ",(0,r.jsx)(n.code,{children:"ENTRYPOINT"}),", ",(0,r.jsx)(n.code,{children:"COPY"}),", and ",(0,r.jsx)(n.code,{children:"ADD"})," instructions."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"WORKDIR /app\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CMD"}),(0,r.jsx)(n.br,{}),"\n","Provides the default command that will run when the container starts. A Dockerfile can only have one ",(0,r.jsx)(n.code,{children:"CMD"})," instruction, and it is usually used to start the application."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'CMD ["python3", "app.py"]\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"ENTRYPOINT"}),(0,r.jsx)(n.br,{}),"\n","Similar to ",(0,r.jsx)(n.code,{children:"CMD"}),", but allows you to configure the container to run a specific executable. The main difference between ",(0,r.jsx)(n.code,{children:"CMD"})," and ",(0,r.jsx)(n.code,{children:"ENTRYPOINT"})," is that ",(0,r.jsx)(n.code,{children:"CMD"})," can be overridden by providing a new command when running the container, whereas ",(0,r.jsx)(n.code,{children:"ENTRYPOINT"})," is harder to override."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'ENTRYPOINT ["python3", "app.py"]\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"EXPOSE"}),(0,r.jsx)(n.br,{}),"\n","Indicates which ports the container will listen on. This is used for documentation purposes and is not a security feature."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"EXPOSE 8080\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"ENV"}),(0,r.jsx)(n.br,{}),"\n","Sets environment variables inside the container. These variables can be used by applications running inside the container."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"ENV APP_ENV=production\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"VOLUME"}),(0,r.jsx)(n.br,{}),"\n","Creates a mount point for volumes, which allows data to persist outside the container or be shared between containers."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'VOLUME ["/data"]\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"USER"}),(0,r.jsx)(n.br,{}),"\n","Sets the user for the container to run as. By default, containers run as root, but it\u2019s a good practice to use a non-root user for security reasons."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"USER nonrootuser\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"ARG"}),(0,r.jsx)(n.br,{}),"\n","Defines build-time variables that can be passed at build time. These variables can be used in the Dockerfile during the build process."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"ARG VERSION=1.0\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"HEALTHCHECK"}),(0,r.jsx)(n.br,{}),"\n","Defines a command to test whether the container is working correctly. This can be used to check the health of an application inside the container."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"HEALTHCHECK CMD curl --fail http://localhost:8080/health || exit 1\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"SHELL"}),(0,r.jsx)(n.br,{}),"\n","Allows you to override the default shell used by the ",(0,r.jsx)(n.code,{children:"RUN"})," instruction."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'SHELL ["/bin/bash", "-c"]\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"example-of-a-simple-dockerfile",children:"Example of a Simple Dockerfile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'# Use an official Python runtime as a parent image\r\nFROM python:3.9-slim\r\n\r\n# Set the working directory in the container\r\nWORKDIR /app\r\n\r\n# Copy the current directory contents into the container at /app\r\nCOPY . /app\r\n\r\n# Install any needed packages specified in requirements.txt\r\nRUN pip install --no-cache-dir -r requirements.txt\r\n\r\n# Make port 80 available to the world outside this container\r\nEXPOSE 80\r\n\r\n# Set environment variables\r\nENV APP_ENV=production\r\n\r\n# Run app.py when the container launches\r\nCMD ["python", "app.py"]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"key-considerations-when-writing-a-dockerfile",children:"Key Considerations When Writing a Dockerfile"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Efficiency"}),":",(0,r.jsx)(n.br,{}),"\n","Each instruction in a Dockerfile creates a layer in the final image, so it's important to minimize the number of layers by combining instructions where possible."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"RUN apt-get update && apt-get install -y python3 python3-pip\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Leverage Caching"}),":",(0,r.jsx)(n.br,{}),"\n","Docker caches each layer during the build process, so if nothing has changed in the Dockerfile, Docker will reuse the cached layers, making builds faster. To take advantage of caching, place less frequently changed instructions, such as package installations, towards the top of the Dockerfile."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Security"}),":",(0,r.jsx)(n.br,{}),"\n","Avoid running your container as root by using the ",(0,r.jsx)(n.code,{children:"USER"})," instruction to create a non-root user. Additionally, ensure sensitive data (like API keys) are not hardcoded into the Dockerfile."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Multistage Builds"}),":",(0,r.jsx)(n.br,{}),"\n","Docker supports multistage builds, which allows you to use one Dockerfile to build multiple images, reducing the size of the final image. This is useful when you need to compile code or build assets and don\u2019t need the build dependencies in the final image."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# First stage: build the application\r\nFROM node:14 as build\r\nWORKDIR /app\r\nCOPY . .\r\nRUN npm install\r\nRUN npm run build\r\n\r\n# Second stage: copy the built app into a minimal image\r\nFROM nginx:alpine\r\nCOPY --from=build /app/dist /usr/share/nginx/html\r\nEXPOSE 80\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Versioning"}),":",(0,r.jsx)(n.br,{}),"\n","Always specify versions for the base images (e.g., ",(0,r.jsx)(n.code,{children:"FROM ubuntu:20.04"}),") to ensure consistency across builds and avoid breaking changes due to base image updates."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Clean Up"}),":",(0,r.jsx)(n.br,{}),"\n","To reduce the image size, it is a good practice to remove unnecessary files after installing packages or performing tasks. This can be done in a single ",(0,r.jsx)(n.code,{children:"RUN"})," step."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"RUN apt-get update && apt-get install -y build-essential && rm -rf /var/lib/apt/lists/*\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Order of Instructions"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Place ",(0,r.jsx)(n.code,{children:"COPY"})," and ",(0,r.jsx)(n.code,{children:"ADD"})," instructions near the end to maximize caching."]}),"\n",(0,r.jsxs)(n.li,{children:["Place the ",(0,r.jsx)(n.code,{children:"RUN"})," instruction for installing dependencies near the top of the Dockerfile."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Minimize Image Size"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use minimal base images like ",(0,r.jsx)(n.code,{children:"alpine"})," when possible."]}),"\n",(0,r.jsx)(n.li,{children:"Use multi-stage builds to separate build dependencies from runtime dependencies."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Use ",(0,r.jsx)(n.code,{children:".dockerignore"})]}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Similar to ",(0,r.jsx)(n.code,{children:".gitignore"}),", the ",(0,r.jsx)(n.code,{children:".dockerignore"})," file allows you to exclude files and directories from being copied into the Docker image. This reduces the image size and prevents unnecessary files (e.g., ",(0,r.jsx)(n.code,{children:".git"})," folders) from being included."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:".git\r\nnode_modules\r\n*.log\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Avoid Using ",(0,r.jsx)(n.code,{children:"latest"})," Tag"]}),":",(0,r.jsx)(n.br,{}),"\n","It's better to specify explicit version tags for images (e.g., ",(0,r.jsx)(n.code,{children:"python:3.9-slim"}),") rather than relying on ",(0,r.jsx)(n.code,{children:"latest"}),", which could change and break your builds."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var s=i(96540);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);