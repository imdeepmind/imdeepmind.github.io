"use strict";(self.webpackChunkimdeepmind=self.webpackChunkimdeepmind||[]).push([[8647],{386:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"system-design/containers/chroot","title":"chroot in Linux","description":"What is chroot?","source":"@site/docs/system-design/containers/chroot.md","sourceDirName":"system-design/containers","slug":"/system-design/containers/chroot","permalink":"/docs/system-design/containers/chroot","draft":false,"unlisted":false,"editUrl":"https://github.com/imdeepmind/imdeepmind.github.io/blob/main/docs/system-design/containers/chroot.md","tags":[],"version":"current","lastUpdatedBy":"Abhishek Chatterjee","lastUpdatedAt":1735140631000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Docker Internals","permalink":"/docs/system-design/containers/internals"},"next":{"title":"Linux Namespaces","permalink":"/docs/system-design/containers/namespaces"}}');var o=i(4848),t=i(8453);const r={sidebar_position:3},l="chroot in Linux",a={},c=[{value:"What is <code>chroot</code>?",id:"what-is-chroot",level:2},{value:"How <code>chroot</code> Works",id:"how-chroot-works",level:2},{value:"Running Bash Inside a Chroot Jail",id:"running-bash-inside-a-chroot-jail",level:2},{value:"Create a Directory for the Jail",id:"create-a-directory-for-the-jail",level:3},{value:"Install Necessary Files",id:"install-necessary-files",level:3},{value:"Chroot into the Jail and Run Bash",id:"chroot-into-the-jail-and-run-bash",level:3},{value:"You are now in the chrooted environment",id:"you-are-now-in-the-chrooted-environment",level:3},{value:"Exit the Jail",id:"exit-the-jail",level:3},{value:"Limitations of <code>chroot</code>",id:"limitations-of-chroot",level:2},{value:"Chroot and Containers",id:"chroot-and-containers",level:2}];function h(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsxs)(s.h1,{id:"chroot-in-linux",children:[(0,o.jsx)(s.code,{children:"chroot"})," in Linux"]})}),"\n",(0,o.jsxs)(s.h2,{id:"what-is-chroot",children:["What is ",(0,o.jsx)(s.code,{children:"chroot"}),"?"]}),"\n",(0,o.jsxs)(s.p,{children:["The command ",(0,o.jsx)(s.code,{children:"chroot"}),' stands for "change root" and is a Unix/Linux system call and command used to change the apparent root directory of the current running process and its children to a new location in the filesystem. Once a process is "chrooted," it can only access files inside the new root directory, which is effectively isolated from the rest of the filesystem. This is often referred to as a ',(0,o.jsx)(s.strong,{children:"chroot jail"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["The ",(0,o.jsx)(s.code,{children:"chroot"})," command creates an isolated environment for running processes, which is particularly useful for testing, security, and system recovery."]}),"\n",(0,o.jsxs)(s.h2,{id:"how-chroot-works",children:["How ",(0,o.jsx)(s.code,{children:"chroot"})," Works"]}),"\n",(0,o.jsxs)(s.p,{children:["When you use ",(0,o.jsx)(s.code,{children:"chroot"}),", you provide a path to the directory that will act as the root directory for the process. This new root is only visible to the chrooted process and its children. The process running inside the chroot jail believes it is operating in a fully functional system, but in reality, it is isolated from the real root directory of the system."]}),"\n",(0,o.jsxs)(s.p,{children:["Here\u2019s a high-level view of how ",(0,o.jsx)(s.code,{children:"chroot"})," works:"]}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsx)(s.li,{children:"The system call changes the root directory for the process and its children to a specified directory."}),"\n",(0,o.jsx)(s.li,{children:"The process is restricted to the directory tree under that new root."}),"\n",(0,o.jsx)(s.li,{children:"Any attempt to access files outside the chroot directory will result in an error."}),"\n"]}),"\n",(0,o.jsx)(s.mermaid,{value:'graph LR\n    A[Host System] --\x3e B["Root File System (/) of Host"]\n    A[Host System] --\x3e C["Root File System (/) of Chroot"]\n    B --\x3e|Access to All Files| D["File 1 (Outside Jail)"]\n    C --\x3e|Limited Access to Files| E["File 2 (Inside Jail)"]\n    C --\x3e|Process Running in Jail| F[Chrooted Process]'}),"\n",(0,o.jsx)(s.p,{children:"In the diagram above:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"The host system has a full filesystem."}),"\n",(0,o.jsxs)(s.li,{children:["A chroot jail is created in ",(0,o.jsx)(s.code,{children:"/path/to/jail"}),", and processes running inside it can only access files inside the jail."]}),"\n",(0,o.jsxs)(s.li,{children:["The ",(0,o.jsx)(s.code,{children:"chroot"})," command isolates processes, preventing them from accessing files outside of the jail."]}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Example"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo chroot /path/to/jail\n"})}),"\n",(0,o.jsxs)(s.p,{children:["This command would change the root of the current process to ",(0,o.jsx)(s.code,{children:"/path/to/jail"}),". Any file system operation in the jail will be confined to this directory and its subdirectories."]}),"\n",(0,o.jsx)(s.h2,{id:"running-bash-inside-a-chroot-jail",children:"Running Bash Inside a Chroot Jail"}),"\n",(0,o.jsxs)(s.p,{children:["One common use case for ",(0,o.jsx)(s.code,{children:"chroot"})," is to run a shell, such as ",(0,o.jsx)(s.code,{children:"bash"}),", inside a chroot jail. Here are the steps to achieve it"]}),"\n",(0,o.jsx)(s.mermaid,{value:'graph TB\n    A[Host System] --\x3e B["Original Root File System (/)"]\n    B --\x3e|Copy Files| C["Chroot Jail (/path/to/jail)"]\n    C --\x3e D[Essential Binaries & Libraries]\n    D --\x3e E[Run bash in Chroot]\n    E --\x3e F[Chrooted Bash Process]\n    E --\x3e|Isolation| G[Limited File System Access]'}),"\n",(0,o.jsx)(s.p,{children:"In the diagram above:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["The ",(0,o.jsx)(s.strong,{children:"Host System"})," has a full root filesystem."]}),"\n",(0,o.jsxs)(s.li,{children:["The ",(0,o.jsx)(s.strong,{children:"Chroot Jail"})," is created, and essential files like the bash binary and libraries are copied into it."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Running bash in the Chroot Jail"})," leads to a process that is isolated from the rest of the filesystem."]}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"create-a-directory-for-the-jail",children:"Create a Directory for the Jail"}),"\n",(0,o.jsx)(s.p,{children:"First, create the directory that will act as the new root directory for the chrooted environment."}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo mkdir /path/to/jail\n"})}),"\n",(0,o.jsx)(s.h3,{id:"install-necessary-files",children:"Install Necessary Files"}),"\n",(0,o.jsxs)(s.p,{children:["You need to copy essential binaries, libraries, and configuration files into the chroot jail. For a basic bash environment, you will need the ",(0,o.jsx)(s.code,{children:"bash"})," binary, its libraries, and other necessary files."]}),"\n",(0,o.jsx)(s.p,{children:"Here\u2019s an example of how to set up a simple bash environment:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsxs)(s.strong,{children:["Copy the ",(0,o.jsx)(s.code,{children:"bash"})," binary"]})," into the jail:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo cp /bin/bash /path/to/jail/bin/\n"})}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Copy essential libraries"}),":\nThe bash shell relies on certain shared libraries. You can find out which libraries are needed using ",(0,o.jsx)(s.code,{children:"ldd"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"ldd /bin/bash\n"})}),"\n",(0,o.jsxs)(s.p,{children:["This will show the list of libraries required by ",(0,o.jsx)(s.code,{children:"bash"}),". You need to copy these libraries into the ",(0,o.jsx)(s.code,{children:"lib"})," directory of the chroot jail. For example:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo cp /lib/x86_64-linux-gnu/libtinfo.so.6 /path/to/jail/lib/x86_64-linux-gnu/\nsudo cp /lib/x86_64-linux-gnu/libc.so.6 /path/to/jail/lib/x86_64-linux-gnu/\n"})}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Copy any other necessary files"}),":\nFor the environment to work properly, you may need to copy other system files like ",(0,o.jsx)(s.code,{children:"/etc/passwd"}),", ",(0,o.jsx)(s.code,{children:"/etc/group"}),", etc. into the jail to allow the chrooted process to run with basic user information:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo cp /etc/passwd /path/to/jail/etc/\nsudo cp /etc/group /path/to/jail/etc/\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"chroot-into-the-jail-and-run-bash",children:"Chroot into the Jail and Run Bash"}),"\n",(0,o.jsxs)(s.p,{children:["After setting up the environment, you can use ",(0,o.jsx)(s.code,{children:"chroot"})," to change the root and run the ",(0,o.jsx)(s.code,{children:"bash"})," shell inside the jail:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sudo chroot /path/to/jail /bin/bash\n"})}),"\n",(0,o.jsxs)(s.p,{children:["This command will change the root of the current process to ",(0,o.jsx)(s.code,{children:"/path/to/jail"})," and run ",(0,o.jsx)(s.code,{children:"/bin/bash"})," inside that chroot jail."]}),"\n",(0,o.jsx)(s.h3,{id:"you-are-now-in-the-chrooted-environment",children:"You are now in the chrooted environment"}),"\n",(0,o.jsxs)(s.p,{children:["After running the above command, you will be inside the chrooted environment and running ",(0,o.jsx)(s.code,{children:"bash"})," with a root filesystem that is isolated from the host system. Any file system operations inside the jail will only affect files within the jail."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"root@chroot:/#\n"})}),"\n",(0,o.jsx)(s.h3,{id:"exit-the-jail",children:"Exit the Jail"}),"\n",(0,o.jsxs)(s.p,{children:["To exit the chroot environment and return to the original system, simply type ",(0,o.jsx)(s.code,{children:"exit"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"root@chroot:/# exit\n"})}),"\n",(0,o.jsxs)(s.h2,{id:"limitations-of-chroot",children:["Limitations of ",(0,o.jsx)(s.code,{children:"chroot"})]}),"\n",(0,o.jsxs)(s.p,{children:["While ",(0,o.jsx)(s.code,{children:"chroot"})," is useful for creating isolated environments, it has some limitations:"]}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"No Kernel-Level Isolation"}),": ",(0,o.jsx)(s.code,{children:"chroot"})," does not provide kernel-level isolation. Processes inside the chroot jail can still potentially break out of the jail if they have root privileges. For example, a process inside the jail can still interact with the kernel directly."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"No Resource Limiting"}),": ",(0,o.jsx)(s.code,{children:"chroot"})," does not provide any mechanism for controlling resources like CPU or memory usage, unlike modern containers (which use cgroups)."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Security"}),": Without additional mechanisms, ",(0,o.jsx)(s.code,{children:"chroot"})," offers limited security. If a process inside the jail has sufficient privileges, it may be able to escape the jail."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"No Network Isolation"}),": Processes inside the chroot jail can still communicate over the network unless additional isolation mechanisms (e.g., network namespaces in containers) are applied."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"chroot-and-containers",children:"Chroot and Containers"}),"\n",(0,o.jsxs)(s.p,{children:["Containers, such as Docker, use ",(0,o.jsx)(s.code,{children:"chroot"})," as a part of their isolation process but go much further by leveraging additional technologies like namespaces, cgroups, and a union file system to provide complete process and resource isolation. Docker, for example, uses namespaces to isolate network, process, and filesystem views."]})]})}function d(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,s,i)=>{i.d(s,{R:()=>r,x:()=>l});var n=i(6540);const o={},t=n.createContext(o);function r(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);