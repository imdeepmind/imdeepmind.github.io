"use strict";(self.webpackChunkimdeepmind=self.webpackChunkimdeepmind||[]).push([[1553],{88124:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"system-design/containers/namespaces","title":"Linux Namespaces","description":"Overview of Namespaces","source":"@site/docs/system-design/containers/namespaces.md","sourceDirName":"system-design/containers","slug":"/system-design/containers/namespaces","permalink":"/docs/system-design/containers/namespaces","draft":false,"unlisted":false,"editUrl":"https://github.com/imdeepmind/imdeepmind.github.io/blob/main/docs/system-design/containers/namespaces.md","tags":[],"version":"current","lastUpdatedBy":"Abhishek Chatterjee","lastUpdatedAt":1735140631000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"chroot in Linux","permalink":"/docs/system-design/containers/chroot"},"next":{"title":"cgroups in Linux","permalink":"/docs/system-design/containers/cgroups"}}');var i=n(74848),t=n(28453);const o={sidebar_position:4},r="Linux Namespaces",c={},l=[{value:"Overview of Namespaces",id:"overview-of-namespaces",level:2},{value:"Diagram: Relationship Between Host and Namespaces",id:"diagram-relationship-between-host-and-namespaces",level:2},{value:"Creating and Using Namespaces",id:"creating-and-using-namespaces",level:2},{value:"Create a Custom Root Filesystem",id:"create-a-custom-root-filesystem",level:3},{value:"Example:",id:"example",level:4},{value:"Run a Shell in a New Namespace",id:"run-a-shell-in-a-new-namespace",level:3},{value:"Example:",id:"example-1",level:4},{value:"Use <code>chroot</code> to Enter the Custom Root",id:"use-chroot-to-enter-the-custom-root",level:3},{value:"Example:",id:"example-2",level:4},{value:"Diagram: Namespaces with Custom Root",id:"diagram-namespaces-with-custom-root",level:2}];function d(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"linux-namespaces",children:"Linux Namespaces"})}),"\n",(0,i.jsx)(s.h2,{id:"overview-of-namespaces",children:"Overview of Namespaces"}),"\n",(0,i.jsx)(s.p,{children:"Linux namespaces are a feature of the Linux kernel that allows the isolation of system resources between processes. They form the foundation of containerization technologies like Docker and Kubernetes. By using namespaces, processes can have their own view of system resources, such as:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"PID (Process ID)"}),": Isolates the process ID number space."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Mount"}),": Isolates filesystem mount points."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"UTS (UNIX Timesharing System)"}),": Isolates the hostname and domain name."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Network"}),": Isolates network interfaces and settings."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"IPC (Inter-Process Communication)"}),": Isolates IPC resources like message queues and shared memory."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"User"}),": Isolates user and group IDs."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Each namespace type provides isolation for specific resources, ensuring that changes made in one namespace do not affect others."}),"\n",(0,i.jsx)(s.h2,{id:"diagram-relationship-between-host-and-namespaces",children:"Diagram: Relationship Between Host and Namespaces"}),"\n",(0,i.jsx)(s.p,{children:"The following diagram represents a high-level view of how namespaces isolate resources:"}),"\n",(0,i.jsx)(s.mermaid,{value:"graph LR\n    A[Host System] --\x3e B[Global Namespace]\n    A --\x3e C[Namespace 1]\n    A --\x3e D[Namespace 2]\n    B --\x3e|Shared Resources| E[Processes in Global Namespace]\n    C --\x3e|Isolated Resources| F[Processes in Namespace 1]\n    D --\x3e|Isolated Resources| G[Processes in Namespace 2]"}),"\n",(0,i.jsx)(s.p,{children:"In this example:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"The host system can have a global namespace."}),"\n",(0,i.jsx)(s.li,{children:"Each namespace isolates its processes and resources."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"creating-and-using-namespaces",children:"Creating and Using Namespaces"}),"\n",(0,i.jsxs)(s.p,{children:["To work with namespaces, the ",(0,i.jsx)(s.code,{children:"unshare"})," command is commonly used. Here's a step-by-step guide on creating a new namespace, using a custom root with ",(0,i.jsx)(s.code,{children:"chroot"}),", and running a bash shell inside it."]}),"\n",(0,i.jsx)(s.h3,{id:"create-a-custom-root-filesystem",children:"Create a Custom Root Filesystem"}),"\n",(0,i.jsxs)(s.p,{children:["To use ",(0,i.jsx)(s.code,{children:"chroot"}),", first create a minimal custom root filesystem. This can be done using the ",(0,i.jsx)(s.code,{children:"debootstrap"})," tool (on Debian-based systems) or manually copying necessary binaries and libraries."]}),"\n",(0,i.jsx)(s.h4,{id:"example",children:"Example:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"mkdir /tmp/custom-root\ncd /tmp/custom-root\nmkdir -p bin lib64 etc dev\ncp /bin/bash bin/\ncp -v /lib64/ld-linux-x86-64.so.2 lib64/\ncp -v /lib/x86_64-linux-gnu/libc.so.6 lib64/\ncp -v /lib/x86_64-linux-gnu/libdl.so.2 lib64/\n"})}),"\n",(0,i.jsxs)(s.p,{children:["This creates a minimal root filesystem containing ",(0,i.jsx)(s.code,{children:"bash"})," and its dependencies."]}),"\n",(0,i.jsx)(s.h3,{id:"run-a-shell-in-a-new-namespace",children:"Run a Shell in a New Namespace"}),"\n",(0,i.jsxs)(s.p,{children:["Use the ",(0,i.jsx)(s.code,{children:"unshare"})," command to create and enter new namespaces."]}),"\n",(0,i.jsx)(s.h4,{id:"example-1",children:"Example:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo unshare --mount --uts --ipc --net --pid --fork --user bash\n"})}),"\n",(0,i.jsx)(s.p,{children:"This creates a new shell with isolated:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Mount points (",(0,i.jsx)(s.code,{children:"--mount"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Hostname (",(0,i.jsx)(s.code,{children:"--uts"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["IPC resources (",(0,i.jsx)(s.code,{children:"--ipc"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Network interfaces (",(0,i.jsx)(s.code,{children:"--net"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["PID namespace (",(0,i.jsx)(s.code,{children:"--pid"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["User IDs (",(0,i.jsx)(s.code,{children:"--user"}),")"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"You are now inside a set of isolated namespaces."}),"\n",(0,i.jsxs)(s.h3,{id:"use-chroot-to-enter-the-custom-root",children:["Use ",(0,i.jsx)(s.code,{children:"chroot"})," to Enter the Custom Root"]}),"\n",(0,i.jsxs)(s.p,{children:["Once inside the new namespace, use ",(0,i.jsx)(s.code,{children:"chroot"})," to change the root filesystem to the custom one created earlier."]}),"\n",(0,i.jsx)(s.h4,{id:"example-2",children:"Example:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo chroot /tmp/custom-root /bin/bash\n"})}),"\n",(0,i.jsx)(s.p,{children:"At this point, you are in a completely isolated environment with a new root filesystem. You can verify this by running commands like:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ls /\n"})}),"\n",(0,i.jsx)(s.h2,{id:"diagram-namespaces-with-custom-root",children:"Diagram: Namespaces with Custom Root"}),"\n",(0,i.jsx)(s.p,{children:"The following diagram shows the relationship between the host system, namespaces, and the custom root:"}),"\n",(0,i.jsx)(s.mermaid,{value:"graph LR\n    A[Host System] --\x3e B[Global Namespace]\n    A --\x3e C[New Namespace]\n    C --\x3e D[Custom Root Filesystem]\n    D --\x3e E[Bash Process in Chroot]"}),"\n",(0,i.jsx)(s.p,{children:"In this setup:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"A new namespace is created."}),"\n",(0,i.jsx)(s.li,{children:"A custom root is used to isolate filesystem operations."}),"\n",(0,i.jsx)(s.li,{children:"Processes in the namespace cannot interact with the host filesystem."}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>r});var a=n(96540);const i={},t=a.createContext(i);function o(e){const s=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(t.Provider,{value:s},e.children)}}}]);